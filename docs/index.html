<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="description" content="Stable Request - A stability-first execution engine for resilient workflows, API integrations, and batch processing in TypeScript.">
  <title>Stable Request</title>
  <link rel="icon" type="image/svg+xml" href="img/favicon.svg">
  <link rel="stylesheet" href="css/styles.css">
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=JetBrains+Mono:wght@400;500&display=swap" rel="stylesheet">
</head>
<body>
  <!-- Navbar -->
  <nav class="navbar">
    <div class="navbar-left">
      <button class="sidebar-toggle" id="sidebarToggle" aria-label="Toggle sidebar">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
          <line x1="3" y1="12" x2="21" y2="12"></line>
          <line x1="3" y1="6" x2="21" y2="6"></line>
          <line x1="3" y1="18" x2="21" y2="18"></line>
        </svg>
      </button>
      <a href="#top" class="brand">
        <img src="img/icon.svg" alt="Stable Request" class="brand-icon">
        <span class="brand-name">Stable Request</span>
      </a>
    </div>
    <div class="navbar-right">
      <a href="https://www.npmjs.com/package/@emmvish/stable-request" target="_blank" rel="noopener" class="nav-link" title="NPM Package">
        <span class="nav-icon">
          <svg viewBox="0 0 24 24" fill="currentColor">
            <path d="M1.763 0C.786 0 0 .786 0 1.763v20.474C0 23.214.786 24 1.763 24h20.474c.977 0 1.763-.786 1.763-1.763V1.763C24 .786 23.214 0 22.237 0zM5.13 5.323l13.837.019-.009 13.836h-3.464l.01-10.382h-3.456L12.04 19.17H5.113z"/>
          </svg>
        </span>
        <span>NPM</span>
      </a>
      <a href="https://github.com/emmvish/stable-request" target="_blank" rel="noopener" class="nav-link" title="GitHub Repository">
        <span class="nav-icon">
          <svg viewBox="0 0 24 24" fill="currentColor">
            <path d="M12 0C5.374 0 0 5.373 0 12c0 5.302 3.438 9.8 8.207 11.387.599.111.793-.261.793-.577v-2.234c-3.338.726-4.033-1.416-4.033-1.416-.546-1.387-1.333-1.756-1.333-1.756-1.089-.745.083-.729.083-.729 1.205.084 1.839 1.237 1.839 1.237 1.07 1.834 2.807 1.304 3.492.997.107-.775.418-1.305.762-1.604-2.665-.305-5.467-1.334-5.467-5.931 0-1.311.469-2.381 1.236-3.221-.124-.303-.535-1.524.117-3.176 0 0 1.008-.322 3.301 1.23A11.509 11.509 0 0112 5.803c1.02.005 2.047.138 3.006.404 2.291-1.552 3.297-1.23 3.297-1.23.653 1.653.242 2.874.118 3.176.77.84 1.235 1.911 1.235 3.221 0 4.609-2.807 5.624-5.479 5.921.43.372.823 1.102.823 2.222v3.293c0 .319.192.694.801.576C20.566 21.797 24 17.3 24 12c0-6.627-5.373-12-12-12z"/>
          </svg>
        </span>
        <span>GitHub</span>
      </a>
      <a href="https://github.com/Emmvish/stable-request/tree/main/docs/api-references" target="_blank" class="nav-link" title="API References">
        <span class="nav-icon">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path>
            <polyline points="14 2 14 8 20 8"></polyline>
            <line x1="16" y1="13" x2="8" y2="13"></line>
            <line x1="16" y1="17" x2="8" y2="17"></line>
            <polyline points="10 9 9 9 8 9"></polyline>
          </svg>
        </span>
        <span>API Docs</span>
      </a>
    </div>
  </nav>

  <!-- Sidebar -->
  <aside class="sidebar" id="sidebar">
    <div class="sidebar-section">
      <h6 class="sidebar-title">Getting Started</h6>
      <nav class="sidebar-nav">
        <a href="#top">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M3 9l9-7 9 7v11a2 2 0 01-2 2H5a2 2 0 01-2-2z"/><polyline points="9 22 9 12 15 12 15 22"/></svg>
          Introduction
        </a>
        <a href="#get-started">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M21 15v4a2 2 0 01-2 2H5a2 2 0 01-2-2v-4M7 10l5 5 5-5M12 15V3"/></svg>
          Installation
        </a>
      </nav>
    </div>
    <div class="sidebar-section">
      <h6 class="sidebar-title">Core APIs</h6>
      <nav class="sidebar-nav">
        <a href="#core-apis">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="3" y="3" width="18" height="18" rx="2"/><path d="M9 9h6v6H9z"/></svg>
          Overview
        </a>
        <a href="#tab-stableRequest" data-tab="stableRequest">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M21 12a9 9 0 01-9 9m9-9a9 9 0 00-9-9m9 9H3m9 9a9 9 0 01-9-9m9 9c1.657 0 3-4.03 3-9s-1.343-9-3-9m0 18c-1.657 0-3-4.03-3-9s1.343-9 3-9"/></svg>
          stableRequest
        </a>
        <a href="#tab-stableFunction" data-tab="stableFunction">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M14.7 6.3a1 1 0 000 1.4l1.6 1.6a1 1 0 001.4 0l3.77-3.77a6 6 0 01-7.94 7.94l-6.91 6.91a2.12 2.12 0 01-3-3l6.91-6.91a6 6 0 017.94-7.94l-3.76 3.76z"/></svg>
          stableFunction
        </a>
        <a href="#tab-stableApiGateway" data-tab="stableApiGateway">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="2" y="7" width="20" height="14" rx="2"/><path d="M16 3h-8l-2 4h12z"/></svg>
          stableApiGateway
        </a>
        <a href="#tab-stableWorkflow" data-tab="stableWorkflow">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M22 12h-4l-3 9L9 3l-3 9H2"/></svg>
          stableWorkflow
        </a>
        <a href="#tab-stableWorkflowGraph" data-tab="stableWorkflowGraph">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="18" cy="5" r="3"/><circle cx="6" cy="12" r="3"/><circle cx="18" cy="19" r="3"/><path d="M8.59 13.51l6.83 3.98M15.41 6.51l-6.82 3.98"/></svg>
          stableWorkflowGraph
        </a>
      </nav>
    </div>
    <div class="sidebar-section">
      <h6 class="sidebar-title">Concepts</h6>
      <nav class="sidebar-nav">
        <a href="#resilience-stack">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z"/></svg>
          Resilience Stack
        </a>
        <a href="#workflows">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="16 3 21 3 21 8"/><line x1="4" y1="20" x2="21" y2="3"/><polyline points="21 16 21 21 16 21"/><line x1="15" y1="15" x2="21" y2="21"/><line x1="4" y1="4" x2="9" y2="9"/></svg>
          Workflow Patterns
        </a>
      </nav>
    </div>
    <div class="sidebar-section">
      <h6 class="sidebar-title">Resources</h6>
      <nav class="sidebar-nav">
        <a href="https://github.com/Emmvish/stable-request/tree/main/docs/api-references" target="_blank">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M14 2H6a2 2 0 00-2 2v16a2 2 0 002 2h12a2 2 0 002-2V8z"/><polyline points="14 2 14 8 20 8"/></svg>
          API References
        </a>
        <a href="https://github.com/emmvish/stable-request" target="_blank">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M9 19c-5 1.5-5-2.5-7-3m14 6v-3.87a3.37 3.37 0 00-.94-2.61c3.14-.35 6.44-1.54 6.44-7A5.44 5.44 0 0020 4.77 5.07 5.07 0 0019.91 1S18.73.65 16 2.48a13.38 13.38 0 00-7 0C6.27.65 5.09 1 5.09 1A5.07 5.07 0 005 4.77a5.44 5.44 0 00-1.5 3.78c0 5.42 3.3 6.61 6.44 7A3.37 3.37 0 009 18.13V22"/></svg>
          GitHub
        </a>
      </nav>
    </div>
  </aside>

  <!-- Main Content -->
  <main class="main-content" id="mainContent">
    <!-- Hero Section -->
    <section class="hero" id="top">
      <div class="hero-bg"></div>
      <div class="hero-visual">
        <div class="floating-node"></div>
        <div class="floating-node"></div>
        <div class="floating-node"></div>
        <div class="floating-node"></div>
      </div>
      <div class="hero-content">
        <div class="hero-badge">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z"/></svg>
          Production-Grade TypeScript Framework
        </div>
        <h1>
          <span class="gradient-text">Stability-First</span><br>
          Execution Engine
        </h1>
        <p class="hero-tagline">
          Build <strong>resilient workflows</strong>, fault-tolerant API integrations, and intelligent batch processing with deterministic error handling, comprehensive observability, and full type safety.
        </p>
        <div class="hero-cta">
          <a href="#core-apis" class="btn btn-primary">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polygon points="5 3 19 12 5 21 5 3"/></svg>
            Explore APIs
          </a>
          <a href="#get-started" class="btn btn-secondary">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M21 15v4a2 2 0 01-2 2H5a2 2 0 01-2-2v-4M7 10l5 5 5-5M12 15V3"/></svg>
            Install Package
          </a>
        </div>
      </div>
    </section>

    <!-- Get Started Section -->
    <section class="section" id="get-started">
      <div class="section-header">
        <h2><span class="gradient-text">Get Started</span></h2>
        <p>Install the framework and start building resilient applications in minutes.</p>
      </div>

      <div class="install-box">
        <div class="install-commands">
          <div class="code-box">
            <div class="code-box-header">
              <div class="code-box-dots">
                <span></span><span></span><span></span>
              </div>
              <span class="code-box-lang">npm</span>
              <button class="copy-btn" onclick="copyCode(this)">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="9" y="9" width="13" height="13" rx="2"/><path d="M5 15H4a2 2 0 01-2-2V4a2 2 0 012-2h9a2 2 0 012 2v1"/></svg>
                Copy
              </button>
            </div>
            <pre class="install-pre"><code>npm i @emmvish/stable-request</code></pre>
          </div>

          <div class="code-box">
            <div class="code-box-header">
              <div class="code-box-dots">
                <span></span><span></span><span></span>
              </div>
              <span class="code-box-lang">yarn</span>
              <button class="copy-btn" onclick="copyCode(this)">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="9" y="9" width="13" height="13" rx="2"/><path d="M5 15H4a2 2 0 01-2-2V4a2 2 0 012-2h9a2 2 0 012 2v1"/></svg>
                Copy
              </button>
            </div>
            <pre class="install-pre"><code>yarn add @emmvish/stable-request</code></pre>
          </div>

          <div class="code-box">
            <div class="code-box-header">
              <div class="code-box-dots">
                <span></span><span></span><span></span>
              </div>
              <span class="code-box-lang">pnpm</span>
              <button class="copy-btn" onclick="copyCode(this)">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="9" y="9" width="13" height="13" rx="2"/><path d="M5 15H4a2 2 0 01-2-2V4a2 2 0 012-2h9a2 2 0 012 2v1"/></svg>
                Copy
              </button>
            </div>
            <pre class="install-pre"><code>pnpm add @emmvish/stable-request</code></pre>
          </div>
        </div>

        <div class="quick-links">
          <a href="https://www.npmjs.com/package/@emmvish/stable-request" target="_blank" class="quick-link">
            <svg viewBox="0 0 24 24" fill="currentColor" width="24" height="24">
              <path d="M1.763 0C.786 0 0 .786 0 1.763v20.474C0 23.214.786 24 1.763 24h20.474c.977 0 1.763-.786 1.763-1.763V1.763C24 .786 23.214 0 22.237 0zM5.13 5.323l13.837.019-.009 13.836h-3.464l.01-10.382h-3.456L12.04 19.17H5.113z"/>
            </svg>
            <span>View on NPM</span>
          </a>
          <a href="https://github.com/emmvish/stable-request" target="_blank" class="quick-link">
            <svg viewBox="0 0 24 24" fill="currentColor" width="24" height="24">
              <path d="M12 0C5.374 0 0 5.373 0 12c0 5.302 3.438 9.8 8.207 11.387.599.111.793-.261.793-.577v-2.234c-3.338.726-4.033-1.416-4.033-1.416-.546-1.387-1.333-1.756-1.333-1.756-1.089-.745.083-.729.083-.729 1.205.084 1.839 1.237 1.839 1.237 1.07 1.834 2.807 1.304 3.492.997.107-.775.418-1.305.762-1.604-2.665-.305-5.467-1.334-5.467-5.931 0-1.311.469-2.381 1.236-3.221-.124-.303-.535-1.524.117-3.176 0 0 1.008-.322 3.301 1.23A11.509 11.509 0 0112 5.803c1.02.005 2.047.138 3.006.404 2.291-1.552 3.297-1.23 3.297-1.23.653 1.653.242 2.874.118 3.176.77.84 1.235 1.911 1.235 3.221 0 4.609-2.807 5.624-5.479 5.921.43.372.823 1.102.823 2.222v3.293c0 .319.192.694.801.576C20.566 21.797 24 17.3 24 12c0-6.627-5.373-12-12-12z"/>
            </svg>
            <span>GitHub Repo</span>
          </a>
          <a href="https://github.com/Emmvish/stable-request/tree/main/docs/api-references" target="_blank" class="quick-link">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" width="24" height="24">
              <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path>
              <polyline points="14 2 14 8 20 8"></polyline>
              <line x1="16" y1="13" x2="8" y2="13"></line>
              <line x1="16" y1="17" x2="8" y2="17"></line>
            </svg>
            <span>API Docs</span>
          </a>
        </div>
      </div>
    </section>

    <!-- Core APIs Section -->
    <section class="section" id="core-apis">
      <div class="section-header">
        <h2><span class="gradient-text">Five Core APIs</span></h2>
        <p>From single HTTP requests to complex DAG-based workflow orchestration — every execution mode shares the same powerful resilience stack.</p>
      </div>

      <div class="tabs-container">
        <div class="tabs-header">
          <button class="tab-btn active" data-tab="stableRequest">stableRequest</button>
          <button class="tab-btn" data-tab="stableFunction">stableFunction</button>
          <button class="tab-btn" data-tab="stableApiGateway">stableApiGateway</button>
          <button class="tab-btn" data-tab="stableWorkflow">stableWorkflow</button>
          <button class="tab-btn" data-tab="stableWorkflowGraph">stableWorkflowGraph</button>
        </div>

        <!-- stableRequest Tab -->
        <div class="tab-content active" id="tab-stableRequest">
          <div class="tab-info">
            <h3><code>stableRequest</code></h3>
            <p>A robust HTTP request client with automatic retries, caching, circuit breaking, and rate limiting. Execute any HTTP method with full type safety for request and response data.</p>
          </div>
          <div class="problem-statement">
            <h4>Problem Statement</h4>
            <p>You need to fetch user profile data from an external API that occasionally returns 500 errors, has rate limits, and sometimes returns stale data. You want to cache successful responses, implement smart retries with exponential backoff, and validate that the response contains the expected user schema before accepting it.</p>
          </div>
          <div class="code-box">
            <div class="code-box-header">
              <div class="code-box-dots">
                <span></span><span></span><span></span>
              </div>
              <span class="code-box-lang">TypeScript</span>
              <button class="copy-btn" onclick="copyCode(this)">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="9" y="9" width="13" height="13" rx="2"/><path d="M5 15H4a2 2 0 01-2-2V4a2 2 0 012-2h9a2 2 0 012 2v1"/></svg>
                Copy
              </button>
            </div>
            <pre><code><span class="keyword">import</span> { 
  stableRequest, 
  REQUEST_METHODS, 
  VALID_REQUEST_PROTOCOLS,
  RETRY_STRATEGIES,
  CircuitBreaker
} <span class="keyword">from</span> <span class="string">'@emmvish/stable-request'</span>;

(<span class="keyword">async</span> () => {

<span class="comment">// Mock authentication token</span>
<span class="keyword">const</span> token = <span class="string">'your-auth-token-here'</span>;

<span class="comment">// Define strongly-typed interfaces for request/response</span>
<span class="keyword">interface</span> <span class="type">UserProfileRequest</span> {
  <span class="property">userId</span>: <span class="type">string</span>;
  <span class="property">includeActivity</span>?: <span class="type">boolean</span>;
}

<span class="keyword">interface</span> <span class="type">UserProfile</span> {
  <span class="property">id</span>: <span class="type">string</span>;
  <span class="property">name</span>: <span class="type">string</span>;
  <span class="property">email</span>: <span class="type">string</span>;
  <span class="property">subscription</span>: <span class="string">'free'</span> | <span class="string">'pro'</span> | <span class="string">'enterprise'</span>;
  <span class="property">lastActive</span>: <span class="type">string</span>;
}

<span class="comment">// Create a shared circuit breaker for user service</span>
<span class="keyword">const</span> userServiceBreaker = <span class="keyword">new</span> <span class="function">CircuitBreaker</span>({
  <span class="property">failureThresholdPercentage</span>: <span class="number">30</span>,
  <span class="property">minimumRequests</span>: <span class="number">5</span>,
  <span class="property">recoveryTimeoutMs</span>: <span class="number">30000</span>,
  <span class="property">halfOpenMaxRequests</span>: <span class="number">2</span>
});

<span class="comment">// Execute request with full resilience stack</span>
<span class="keyword">const</span> result = <span class="keyword">await</span> stableRequest&lt;<span class="type">UserProfileRequest</span>, <span class="type">UserProfile</span>&gt;({
  <span class="comment">// HTTP configuration with type-safe body</span>
  <span class="property">reqData</span>: {
    <span class="property">method</span>: REQUEST_METHODS.<span class="property">POST</span>,
    <span class="property">protocol</span>: VALID_REQUEST_PROTOCOLS.<span class="property">HTTPS</span>,
    <span class="property">hostname</span>: <span class="string">'api.userservice.com'</span>,
    <span class="property">path</span>: <span class="string">'/v2/users/profile'</span>,
    <span class="property">headers</span>: { <span class="string">'Authorization'</span>: <span class="string">`Bearer ${token}`</span> },
    <span class="property">body</span>: { <span class="property">userId</span>: <span class="string">'usr_12345'</span>, <span class="property">includeActivity</span>: <span class="keyword">true</span> },
    <span class="property">timeout</span>: <span class="number">5000</span>
  },
  
  <span class="comment">// Return actual response data (not just success boolean)</span>
  <span class="property">resReq</span>: <span class="keyword">true</span>,
  
  <span class="comment">// Retry configuration with exponential backoff</span>
  <span class="property">attempts</span>: <span class="number">4</span>,
  <span class="property">wait</span>: <span class="number">1000</span>,
  <span class="property">maxAllowedWait</span>: <span class="number">15000</span>,
  <span class="property">retryStrategy</span>: RETRY_STRATEGIES.<span class="property">EXPONENTIAL</span>,
  <span class="property">jitter</span>: <span class="number">200</span>, <span class="comment">// Prevent thundering herd</span>
  
  <span class="comment">// Shared circuit breaker instance</span>
  <span class="property">circuitBreaker</span>: userServiceBreaker,
  
  <span class="comment">// Cache configuration for idempotent reads</span>
  <span class="property">cache</span>: {
    <span class="property">enabled</span>: <span class="keyword">true</span>,
    <span class="property">ttl</span>: <span class="number">60000</span>, <span class="comment">// 1 minute cache</span>
    <span class="property">keyGenerator</span>: <span class="keyword">(config) =></span> <span class="string">`user:${config.data?.userId}`</span>
  },
  
  <span class="comment">// Response validation - retry if schema doesn't match</span>
  <span class="property">responseAnalyzer</span>: <span class="keyword">({ data, commonBuffer }) =></span> {
    <span class="keyword">const</span> isValid = !!(data?.id && data?.email && data?.subscription);
    <span class="keyword">if</span> (isValid && commonBuffer) commonBuffer.lastValidUser = data.id;
    <span class="keyword">return</span> isValid;
  },
  
  <span class="comment">// Observability hooks for monitoring</span>
  <span class="property">logAllErrors</span>: <span class="keyword">true</span>,
  <span class="property">handleErrors</span>: <span class="keyword">({ errorLog }) =></span> {
    console.error(<span class="string">'User fetch failed'</span>, errorLog);
  },
  <span class="property">handleSuccessfulAttemptData</span>: <span class="keyword">({ successfulAttemptData }) =></span> {
    console.log(<span class="string">`Fetched user in ${successfulAttemptData.executionTime}ms`</span>);
  },
  
  <span class="comment">// Shared state across attempts</span>
  <span class="property">commonBuffer</span>: { <span class="property">requestStart</span>: Date.now() },
  
  <span class="comment">// Metrics guardrails for anomaly detection</span>
  <span class="property">metricsGuardrails</span>: {
    <span class="property">request</span>: { <span class="property">totalExecutionTime</span>: { <span class="property">max</span>: <span class="number">10000</span> } },
    <span class="property">infrastructure</span>: { <span class="property">circuitBreaker</span>: { <span class="property">failureRate</span>: { <span class="property">max</span>: <span class="number">0.5</span> } } }
  }
});

<span class="comment">// Type-safe result handling</span>
<span class="keyword">if</span> (result.success) {
  <span class="keyword">const</span> user = result.data <span class="keyword">as</span> <span class="type">UserProfile</span>;
  console.log(<span class="string">`Welcome, ${user.name} (${user.subscription})`</span>);
  console.log(<span class="string">`Metrics: ${result.metrics?.totalAttempts} attempts`</span>);
  console.log(<span class="string">`Cache: ${result.metrics?.infrastructureMetrics?.cache?.hits} hits`</span>);
} <span class="keyword">else</span> {
  console.error(<span class="string">`Failed: ${result.error}`</span>);
  console.log(<span class="string">`Error logs: ${result.errorLogs?.length}`</span>);
}

})();</code></pre>
          </div>
        </div>

        <!-- stableFunction Tab -->
        <div class="tab-content" id="tab-stableFunction">
          <div class="tab-info">
            <h3><code>stableFunction</code></h3>
            <p>Execute any synchronous or asynchronous function with the full resilience stack — retries, caching, circuit breaking, rate limiting, and comprehensive observability. Perfect for wrapping database operations, external SDK calls, or complex computations.</p>
          </div>
          <div class="problem-statement">
            <h4>Problem Statement</h4>
            <p>You have an expensive ML inference function that occasionally times out, sometimes returns low-confidence results, and has memory constraints requiring concurrency limits. You want to cache results based on input hash, retry on timeouts, and validate confidence scores before accepting predictions.</p>
          </div>
          <div class="code-box">
            <div class="code-box-header">
              <div class="code-box-dots">
                <span></span><span></span><span></span>
              </div>
              <span class="code-box-lang">TypeScript</span>
              <button class="copy-btn" onclick="copyCode(this)">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="9" y="9" width="13" height="13" rx="2"/><path d="M5 15H4a2 2 0 01-2-2V4a2 2 0 012-2h9a2 2 0 012 2v1"/></svg>
                Copy
              </button>
            </div>
            <pre><code><span class="keyword">import</span> { 
  stableFunction, 
  RETRY_STRATEGIES,
  CircuitBreaker 
} <span class="keyword">from</span> <span class="string">'@emmvish/stable-request'</span>;

(<span class="keyword">async</span> () => {

<span class="comment">// Mock dependencies for demonstration</span>
<span class="keyword">const</span> imageBuffer = Buffer.from(<span class="string">'mock-image-data'</span>);
<span class="keyword">const</span> batchId = <span class="string">'batch-001'</span>;
<span class="keyword">const</span> hashBuffer = (buf: <span class="type">Buffer</span>) => buf.toString(<span class="string">'base64'</span>).slice(<span class="number">0</span>, <span class="number">16</span>);
<span class="keyword">const</span> metrics = { <span class="property">increment</span>: (key: <span class="type">string</span>) => {}, <span class="property">histogram</span>: (key: <span class="type">string</span>, val: <span class="type">number</span>) => {} };
<span class="keyword">const</span> logger = { <span class="property">warn</span>: console.warn, <span class="property">info</span>: console.info };
<span class="keyword">const</span> featureFlags = { <span class="property">get</span>: <span class="keyword">async</span> (key: <span class="type">string</span>) => ({ <span class="property">inferenceTimeout</span>: <span class="number">30000</span> }) };

<span class="comment">// Define typed arguments and return type</span>
<span class="keyword">type</span> <span class="type">InferenceArgs</span> = [
  <span class="property">imageBuffer</span>: <span class="type">Buffer</span>, 
  <span class="property">modelConfig</span>: <span class="type">ModelConfig</span>
];

<span class="keyword">interface</span> <span class="type">ModelConfig</span> {
  <span class="property">modelId</span>: <span class="type">string</span>;
  <span class="property">threshold</span>: <span class="type">number</span>;
  <span class="property">maxTokens</span>?: <span class="type">number</span>;
}

<span class="keyword">interface</span> <span class="type">PredictionResult</span> {
  <span class="property">labels</span>: <span class="type">Array</span>&lt;{ <span class="property">name</span>: <span class="type">string</span>; <span class="property">confidence</span>: <span class="type">number</span> }&gt;;
  <span class="property">processingTime</span>: <span class="type">number</span>;
  <span class="property">modelVersion</span>: <span class="type">string</span>;
}

<span class="comment">// The expensive ML inference function</span>
<span class="keyword">async function</span> <span class="function">runInference</span>(
  imageBuffer: <span class="type">Buffer</span>, 
  config: <span class="type">ModelConfig</span>
): <span class="type">Promise</span>&lt;<span class="type">PredictionResult</span>&gt; {
  <span class="comment">// Simulate ML inference with mock response</span>
  <span class="keyword">await new</span> Promise(<span class="keyword">r =></span> setTimeout(r, <span class="number">100</span>));
  <span class="keyword">return</span> {
    <span class="property">labels</span>: [{ <span class="property">name</span>: <span class="string">'cat'</span>, <span class="property">confidence</span>: <span class="number">0.92</span> }, { <span class="property">name</span>: <span class="string">'dog'</span>, <span class="property">confidence</span>: <span class="number">0.08</span> }],
    <span class="property">processingTime</span>: <span class="number">95</span>,
    <span class="property">modelVersion</span>: config.modelId
  };
}

<span class="comment">// Shared circuit breaker for ML service</span>
<span class="keyword">const</span> mlBreaker = <span class="keyword">new</span> <span class="function">CircuitBreaker</span>({
  <span class="property">failureThresholdPercentage</span>: <span class="number">50</span>,
  <span class="property">minimumRequests</span>: <span class="number">3</span>,
  <span class="property">recoveryTimeoutMs</span>: <span class="number">60000</span>,
  <span class="property">halfOpenMaxRequests</span>: <span class="number">1</span>
});

<span class="comment">// Execute with full resilience stack</span>
<span class="keyword">const</span> result = <span class="keyword">await</span> stableFunction&lt;<span class="type">InferenceArgs</span>, <span class="type">PredictionResult</span>&gt;({
  <span class="comment">// Function and typed arguments</span>
  <span class="property">fn</span>: runInference,
  <span class="property">args</span>: [imageBuffer, { <span class="property">modelId</span>: <span class="string">'resnet-50'</span>, <span class="property">threshold</span>: <span class="number">0.85</span> }],
  
  <span class="comment">// Return the actual prediction result</span>
  <span class="property">returnResult</span>: <span class="keyword">true</span>,
  
  <span class="comment">// Retry configuration for transient failures</span>
  <span class="property">attempts</span>: <span class="number">3</span>,
  <span class="property">wait</span>: <span class="number">2000</span>,
  <span class="property">retryStrategy</span>: RETRY_STRATEGIES.<span class="property">LINEAR</span>,
  <span class="property">jitter</span>: <span class="number">500</span>,
  
  <span class="comment">// Execution timeout to prevent hanging</span>
  <span class="property">executionTimeout</span>: <span class="number">30000</span>,
  
  <span class="comment">// Circuit breaker for fail-fast protection</span>
  <span class="property">circuitBreaker</span>: mlBreaker,
  
  <span class="comment">// Concurrency limit (ML models are memory-intensive)</span>
  <span class="property">maxConcurrentRequests</span>: <span class="number">4</span>,
  
  <span class="comment">// Rate limiting for GPU resource management</span>
  <span class="property">rateLimit</span>: { <span class="property">maxRequests</span>: <span class="number">20</span>, <span class="property">windowMs</span>: <span class="number">10000</span> },
  
  <span class="comment">// Cache predictions by input hash</span>
  <span class="property">cache</span>: {
    <span class="property">enabled</span>: <span class="keyword">true</span>,
    <span class="property">ttl</span>: <span class="number">300000</span>, <span class="comment">// 5 minute cache</span>
    <span class="property">keyGenerator</span>: <span class="keyword">(fn, args) =></span> {
      <span class="keyword">const</span> [buffer, config] = args;
      <span class="keyword">return</span> <span class="string">`inference:${config.modelId}:${hashBuffer(buffer)}`</span>;
    }
  },
  
  <span class="comment">// Validate confidence scores - retry if too low</span>
  <span class="property">responseAnalyzer</span>: <span class="keyword">({ data, args, commonBuffer }) =></span> {
    <span class="keyword">const</span> [, config] = args;
    <span class="keyword">const</span> highConfidence = data.labels.some(
      <span class="keyword">l =></span> l.confidence >= config.threshold
    );
    <span class="keyword">if</span> (highConfidence && commonBuffer) {
      commonBuffer.topLabel = data.labels[<span class="number">0</span>].name;
    }
    <span class="keyword">return</span> highConfidence;
  },
  
  <span class="comment">// Observability hooks</span>
  <span class="property">logAllErrors</span>: <span class="keyword">true</span>,
  <span class="property">handleErrors</span>: <span class="keyword">({ errorLog }) =></span> {
    metrics.increment(<span class="string">'ml.inference.errors'</span>);
    logger.warn(<span class="string">'Inference failed'</span>, { 
      <span class="property">attempt</span>: errorLog.attempt,
      <span class="property">error</span>: errorLog.error 
    });
  },
  <span class="property">logAllSuccessfulAttempts</span>: <span class="keyword">true</span>,
  <span class="property">handleSuccessfulAttemptData</span>: <span class="keyword">({ successfulAttemptData }) =></span> {
    metrics.histogram(<span class="string">'ml.inference.latency'</span>, 
      successfulAttemptData.executionTime
    );
  },
  
  <span class="comment">// Dynamic configuration via pre-execution hook</span>
  <span class="property">preExecution</span>: {
    <span class="property">preExecutionHook</span>: <span class="keyword">async ({ stableFunctionOptions }) =></span> {
      <span class="comment">// Load latest model config from feature flags</span>
      <span class="keyword">const</span> flags = <span class="keyword">await</span> featureFlags.get(<span class="string">'ml-config'</span>);
      <span class="keyword">return</span> {
        <span class="property">executionTimeout</span>: flags.inferenceTimeout || <span class="number">30000</span>
      };
    },
    <span class="property">applyPreExecutionConfigOverride</span>: <span class="keyword">true</span>
  },
  
  <span class="comment">// Shared state and context</span>
  <span class="property">commonBuffer</span>: { <span class="property">batchId</span>: batchId },
  <span class="property">executionContext</span>: { <span class="property">workflowId</span>: <span class="string">'image-classification'</span> },
  
  <span class="comment">// Metrics guardrails</span>
  <span class="property">metricsGuardrails</span>: {
    <span class="property">common</span>: { <span class="property">executionTime</span>: { <span class="property">max</span>: <span class="number">60000</span> } }
  }
});

<span class="comment">// Type-safe result handling</span>
<span class="keyword">if</span> (result.success) {
  <span class="keyword">const</span> prediction: <span class="type">PredictionResult</span> = result.data!;
  console.log(<span class="string">`Top label: ${prediction.labels[0].name}`</span>);
  console.log(<span class="string">`Confidence: ${(prediction.labels[0].confidence * 100).toFixed(1)}%`</span>);
  console.log(<span class="string">`Cache status: ${result.metrics?.infrastructureMetrics?.cache}`</span>);
} <span class="keyword">else</span> {
  console.error(<span class="string">`Inference failed: ${result.error}`</span>);
}

})();</code></pre>
          </div>
        </div>

        <!-- stableApiGateway Tab -->
        <div class="tab-content" id="tab-stableApiGateway">
          <div class="tab-info">
            <h3><code>stableApiGateway</code></h3>
            <p>Batch orchestration engine for executing multiple HTTP requests and functions together. Features request grouping, configuration cascading (Global → Group → Individual), concurrent/sequential execution, shared state buffers, and racing mode for redundant calls.</p>
          </div>
          <div class="problem-statement">
            <h4>Problem Statement</h4>
            <p>Your e-commerce checkout flow needs to: (1) validate inventory across multiple warehouses in parallel, (2) calculate shipping rates from 3 providers and race for the fastest response, (3) process payment, and (4) send confirmation. Each step has different retry/timeout requirements, and you need aggregate metrics and shared state to pass data between steps.</p>
          </div>
          <div class="code-box">
            <div class="code-box-header">
              <div class="code-box-dots">
                <span></span><span></span><span></span>
              </div>
              <span class="code-box-lang">TypeScript</span>
              <button class="copy-btn" onclick="copyCode(this)">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="9" y="9" width="13" height="13" rx="2"/><path d="M5 15H4a2 2 0 01-2-2V4a2 2 0 012-2h9a2 2 0 012 2v1"/></svg>
                Copy
              </button>
            </div>
            <pre><code><span class="keyword">import</span> { 
  stableApiGateway, 
  REQUEST_METHODS,
  RETRY_STRATEGIES,
  RequestOrFunction,
  CircuitBreaker,
  <span class="keyword">type</span> <span class="type">API_GATEWAY_ITEM</span>
} from '@emmvish/stable-request';

(<span class="keyword">async</span> () => {

<span class="comment">// Mock tax rates by state</span>
<span class="keyword">const</span> stateTaxRates: <span class="type">Record</span>&lt;<span class="type">string</span>, <span class="type">number</span>&gt; = {
  <span class="string">'CA'</span>: <span class="number">0.0725</span>, <span class="string">'NY'</span>: <span class="number">0.08</span>, <span class="string">'TX'</span>: <span class="number">0.0625</span>, <span class="string">'WA'</span>: <span class="number">0.065</span>
};

<span class="comment">// Define request body types</span>
<span class="keyword">interface</span> <span class="type">InventoryRequest</span> { <span class="property">sku</span>: <span class="type">string</span>; <span class="property">quantity</span>: <span class="type">number</span>; }
<span class="keyword">interface</span> <span class="type">PaymentRequest</span> { <span class="property">amount</span>: <span class="type">number</span>; <span class="property">currency</span>: <span class="type">string</span>; }

<span class="comment">// Define response types</span>
<span class="keyword">interface</span> <span class="type">InventoryResult</span> { <span class="property">available</span>: <span class="type">boolean</span>; <span class="property">warehouse</span>: <span class="type">string</span>; <span class="property">stock</span>: <span class="type">number</span>; }
<span class="keyword">interface</span> <span class="type">PaymentResult</span> { <span class="property">transactionId</span>: <span class="type">string</span>; <span class="property">status</span>: <span class="type">string</span>; }

<span class="comment">// Define function types</span>
<span class="keyword">type</span> <span class="type">TaxCalcArgs</span> = [<span class="property">subtotal</span>: <span class="type">number</span>, <span class="property">state</span>: <span class="type">string</span>];
<span class="keyword">type</span> <span class="type">TaxResult</span> = { <span class="property">tax</span>: <span class="type">number</span>; <span class="property">total</span>: <span class="type">number</span>; };

<span class="comment">// Union types for mixed gateway items</span>
<span class="keyword">type</span> <span class="type">RequestBodyUnion</span> = <span class="type">InventoryRequest</span> | <span class="type">PaymentRequest</span>;
<span class="keyword">type</span> <span class="type">ResponseUnion</span> = <span class="type">InventoryResult</span> | <span class="type">PaymentResult</span>;

<span class="comment">// Create circuit breaker for gateway</span>
<span class="keyword">const</span> gatewayBreaker = <span class="keyword">new</span> <span class="function">CircuitBreaker</span>({
  <span class="property">failureThresholdPercentage</span>: <span class="number">50</span>,
  <span class="property">minimumRequests</span>: <span class="number">5</span>,
  <span class="property">recoveryTimeoutMs</span>: <span class="number">30000</span>
});

<span class="comment">// Build mixed items array with requests and functions (using union types)</span>
<span class="keyword">const</span> checkoutItems: <span class="type">API_GATEWAY_ITEM</span>&lt;<span class="type">RequestBodyUnion</span>, <span class="type">ResponseUnion</span>, <span class="type">TaxCalcArgs</span>, <span class="type">TaxResult</span>&gt;[] = [
  <span class="comment">// Inventory checks (grouped for shared config)</span>
  {
    <span class="property">type</span>: RequestOrFunction.<span class="property">REQUEST</span>,
    <span class="property">request</span>: {
      <span class="property">id</span>: <span class="string">'inventory-west'</span>,
      <span class="property">groupId</span>: <span class="string">'inventory-checks'</span>,
      <span class="property">requestOptions</span>: {
        <span class="property">reqData</span>: {
          <span class="property">hostname</span>: <span class="string">'warehouse-west.api.com'</span>,
          <span class="property">path</span>: <span class="string">'/inventory/check'</span>,
          <span class="property">method</span>: REQUEST_METHODS.<span class="property">POST</span>,
          <span class="property">body</span>: { <span class="property">sku</span>: <span class="string">'PROD-123'</span>, <span class="property">quantity</span>: <span class="number">2</span> }
        },
        <span class="property">resReq</span>: <span class="keyword">true</span>
      }
    }
  },
  {
    <span class="property">type</span>: RequestOrFunction.<span class="property">REQUEST</span>,
    <span class="property">request</span>: {
      <span class="property">id</span>: <span class="string">'inventory-east'</span>,
      <span class="property">groupId</span>: <span class="string">'inventory-checks'</span>,
      <span class="property">requestOptions</span>: {
        <span class="property">reqData</span>: {
          <span class="property">hostname</span>: <span class="string">'warehouse-east.api.com'</span>,
          <span class="property">path</span>: <span class="string">'/inventory/check'</span>,
          <span class="property">method</span>: REQUEST_METHODS.<span class="property">POST</span>,
          <span class="property">body</span>: { <span class="property">sku</span>: <span class="string">'PROD-123'</span>, <span class="property">quantity</span>: <span class="number">2</span> }
        },
        <span class="property">resReq</span>: <span class="keyword">true</span>
      }
    }
  },
  <span class="comment">// Tax calculation function</span>
  {
    <span class="property">type</span>: RequestOrFunction.<span class="property">FUNCTION</span>,
    <span class="property">function</span>: {
      <span class="property">id</span>: <span class="string">'calculate-tax'</span>,
      <span class="property">functionOptions</span>: {
        <span class="property">fn</span>: <span class="keyword">(subtotal: <span class="type">number</span>, state: <span class="type">string</span>): <span class="type">TaxResult</span> =></span> {
          <span class="keyword">const</span> rate = stateTaxRates[state] || <span class="number">0.08</span>;
          <span class="keyword">return</span> { <span class="property">tax</span>: subtotal * rate, <span class="property">total</span>: subtotal * (<span class="number">1</span> + rate) };
        },
        <span class="property">args</span>: [<span class="number">149.99</span>, <span class="string">'CA'</span>] <span class="keyword">as</span> <span class="type">TaxCalcArgs</span>,
        <span class="property">returnResult</span>: <span class="keyword">true</span>,
        <span class="property">cache</span>: { <span class="property">enabled</span>: <span class="keyword">true</span>, <span class="property">ttl</span>: <span class="number">3600000</span> } <span class="comment">// Cache tax rates</span>
      }
    }
  },
  <span class="comment">// Payment processing (critical - more retries)</span>
  {
    <span class="property">type</span>: RequestOrFunction.<span class="property">REQUEST</span>,
    <span class="property">request</span>: {
      <span class="property">id</span>: <span class="string">'process-payment'</span>,
      <span class="property">groupId</span>: <span class="string">'payment'</span>,
      <span class="property">requestOptions</span>: {
        <span class="property">reqData</span>: {
          <span class="property">hostname</span>: <span class="string">'payments.stripe.com'</span>,
          <span class="property">path</span>: <span class="string">'/v1/charges'</span>,
          <span class="property">method</span>: REQUEST_METHODS.<span class="property">POST</span>,
          <span class="property">body</span>: { <span class="property">amount</span>: <span class="number">16199</span>, <span class="property">currency</span>: <span class="string">'usd'</span> }
        },
        <span class="property">resReq</span>: <span class="keyword">true</span>,
        <span class="property">attempts</span>: <span class="number">5</span>, <span class="comment">// Override group config</span>
        <span class="property">responseAnalyzer</span>: <span class="keyword">({ data }) =></span> (data <span class="keyword">as</span> <span class="type">PaymentResult</span>)?.status === <span class="string">'succeeded'</span>
      }
    }
  }
];

<span class="comment">// Execute with gateway options (pass empty array for separate functions param to use all generics)</span>
<span class="keyword">const</span> result = <span class="keyword">await</span> stableApiGateway&lt;<span class="type">RequestBodyUnion</span>, <span class="type">ResponseUnion</span>, <span class="type">TaxCalcArgs</span>, <span class="type">TaxResult</span>&gt;(checkoutItems, [], {
  <span class="comment">// Parallel execution for independent operations</span>
  <span class="property">concurrentExecution</span>: <span class="keyword">true</span>,
  <span class="property">maxConcurrentRequests</span>: <span class="number">6</span>,
  
  <span class="comment">// Request groups with cascading config</span>
  <span class="property">requestGroups</span>: [
    {
      <span class="property">id</span>: <span class="string">'inventory-checks'</span>,
      <span class="property">commonConfig</span>: {
        <span class="property">commonAttempts</span>: <span class="number">2</span>,
        <span class="property">commonWait</span>: <span class="number">500</span>,
        <span class="property">commonRetryStrategy</span>: RETRY_STRATEGIES.<span class="property">FIXED</span>
      }
    },
    {
      <span class="property">id</span>: <span class="string">'payment'</span>,
      <span class="property">commonConfig</span>: {
        <span class="property">commonAttempts</span>: <span class="number">3</span>,
        <span class="property">commonWait</span>: <span class="number">2000</span>,
        <span class="property">commonRetryStrategy</span>: RETRY_STRATEGIES.<span class="property">EXPONENTIAL</span>,
        <span class="property">commonJitter</span>: <span class="number">300</span>
      }
    }
  ],
  
  <span class="comment">// Global defaults (lowest priority)</span>
  <span class="property">commonAttempts</span>: <span class="number">2</span>,
  <span class="property">commonWait</span>: <span class="number">1000</span>,
  <span class="property">commonLogAllErrors</span>: <span class="keyword">true</span>,
  
  <span class="comment">// Shared state accessible in all items</span>
  <span class="property">sharedBuffer</span>: {
    <span class="property">orderId</span>: <span class="string">'ORD-98765'</span>,
    <span class="property">customerId</span>: <span class="string">'CUST-12345'</span>,
    <span class="property">startTime</span>: Date.now()
  },
  
  <span class="comment">// Global rate limiting</span>
  <span class="property">rateLimit</span>: { <span class="property">maxRequests</span>: <span class="number">50</span>, <span class="property">windowMs</span>: <span class="number">10000</span> },
  
  <span class="comment">// Circuit breaker for entire gateway</span>
  <span class="property">circuitBreaker</span>: gatewayBreaker,
  
  <span class="comment">// Gateway-level timeout</span>
  <span class="property">maxTimeout</span>: <span class="number">60000</span>,
  
  <span class="comment">// Execution context for tracing</span>
  <span class="property">executionContext</span>: { <span class="property">workflowId</span>: <span class="string">'checkout-flow'</span> },
  
  <span class="comment">// Metrics guardrails</span>
  <span class="property">metricsGuardrails</span>: {
    <span class="property">apiGateway</span>: { <span class="property">successRate</span>: { <span class="property">min</span>: <span class="number">0.9</span> } }
  }
});

<span class="comment">// Access individual results by ID (type-safe with union result type)</span>
<span class="keyword">const</span> inventoryWest = result.find(<span class="keyword">(r) =></span> r.requestId === <span class="string">'inventory-west'</span>);
<span class="keyword">const</span> taxResult = result.find(<span class="keyword">(r) =></span> r.requestId === <span class="string">'calculate-tax'</span>);
<span class="keyword">const</span> payment = result.find(<span class="keyword">(r) =></span> r.requestId === <span class="string">'process-payment'</span>);

<span class="comment">// Type-safe result access</span>
<span class="keyword">if</span> (inventoryWest?.success) {
  <span class="keyword">const</span> inventory = inventoryWest.data <span class="keyword">as</span> <span class="type">InventoryResult</span>;
  console.log(<span class="string">`Warehouse: ${inventory.warehouse}, Stock: ${inventory.stock}`</span>);
}

<span class="keyword">if</span> (taxResult?.success) {
  <span class="keyword">const</span> tax = taxResult.data <span class="keyword">as</span> <span class="type">TaxResult</span>;
  console.log(<span class="string">`Tax: $${tax.tax.toFixed(2)}, Total: $${tax.total.toFixed(2)}`</span>);
}

<span class="keyword">if</span> (payment?.success) {
  <span class="keyword">const</span> paymentData = payment.data <span class="keyword">as</span> <span class="type">PaymentResult</span>;
  console.log(<span class="string">`Transaction: ${paymentData.transactionId}, Status: ${paymentData.status}`</span>);
}

<span class="comment">// Aggregate metrics</span>
<span class="keyword">if</span> (result.metrics) {
  console.log(<span class="string">`Success rate: ${result.metrics.successRate.toFixed(1)}%`</span>);
  console.log(<span class="string">`Total time: ${result.metrics.executionTime}ms`</span>);
  console.log(<span class="string">`Throughput: ${result.metrics.throughput.toFixed(2)} items/s`</span>);
  console.log(<span class="string">`Request groups:`</span>, result.metrics.requestGroups);
}

})();</code></pre>
          </div>
        </div>

        <!-- stableWorkflow Tab -->
        <div class="tab-content" id="tab-stableWorkflow">
          <div class="tab-info">
            <h3><code>stableWorkflow</code></h3>
            <p>Array-based multi-phase workflow orchestration with 5 execution modes: Sequential, Concurrent, Mixed (hybrid), Non-Linear (with CONTINUE / SKIP / REPLAY / JUMP / TERMINATE decisions), and Branched (parallel execution paths). Supports phase replay, early termination, and state persistence for workflow recovery.</p>
          </div>
          <div class="problem-statement">
            <h4>Problem Statement</h4>
            <p>Your data pipeline has 4 phases: (1) fetch raw data, (2) validate & clean in parallel with (3) enrichment, then (4) persist. If validation fails, you need to retry with relaxed rules. If enrichment data is stale, skip it. You need shared state between phases, phase-level decision hooks, and the ability to branch for A/B testing different processing strategies.</p>
          </div>
          <div class="code-box">
            <div class="code-box-header">
              <div class="code-box-dots">
                <span></span><span></span><span></span>
              </div>
              <span class="code-box-lang">TypeScript</span>
              <button class="copy-btn" onclick="copyCode(this)">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="9" y="9" width="13" height="13" rx="2"/><path d="M5 15H4a2 2 0 01-2-2V4a2 2 0 012-2h9a2 2 0 012 2v1"/></svg>
                Copy
              </button>
            </div>
            <pre><code><span class="keyword">import</span> { 
  stableWorkflow, 
  PHASE_DECISION_ACTIONS,
  REQUEST_METHODS,
  RequestOrFunction,
  RETRY_STRATEGIES,
  <span class="keyword">type</span> <span class="type">STABLE_WORKFLOW_PHASE</span>
} <span class="keyword">from</span> <span class="string">'@emmvish/stable-request'</span>;

(<span class="keyword">async</span> () => {

<span class="comment">// Mock dependencies for demonstration</span>
<span class="keyword">const</span> logger = { <span class="property">info</span>: console.info, <span class="property">debug</span>: console.error };
<span class="keyword">const</span> redis = {
  <span class="property">set</span>: <span class="keyword">async</span> (key: <span class="type">string</span>, val: <span class="type">any</span>) => { localStorage?.setItem?.(key, JSON.stringify(val)); },
  <span class="property">get</span>: <span class="keyword">async</span> (key: <span class="type">string</span>) => JSON.parse(localStorage?.getItem?.(key) || <span class="string">'null'</span>)
};
<span class="keyword">const</span> validateRecord = (record: <span class="type">any</span>, strict: <span class="type">boolean</span>) => record != <span class="keyword">null</span>;

<span class="comment">// Define request body types (for HTTP requests)</span>
<span class="keyword">interface</span> <span class="type">FetchRequest</span> { <span class="comment">/* empty - GET request */</span> }
<span class="keyword">interface</span> <span class="type">PersistRequest</span> { <span class="property">data</span>: <span class="type">any</span>[]; <span class="property">metadata</span>: <span class="type">Record</span>&lt;<span class="type">string</span>, <span class="type">any</span>&gt;; }

<span class="comment">// Define response types</span>
<span class="keyword">interface</span> <span class="type">RawData</span> { <span class="property">records</span>: <span class="type">any</span>[]; <span class="property">timestamp</span>: <span class="type">string</span>; }
<span class="keyword">interface</span> <span class="type">EnrichedData</span> { <span class="property">records</span>: <span class="type">any</span>[]; <span class="property">enrichedAt</span>: <span class="type">string</span>; }
<span class="keyword">interface</span> <span class="type">PersistResult</span> { <span class="property">success</span>: <span class="type">boolean</span>; }

<span class="comment">// Define function types</span>
<span class="keyword">interface</span> <span class="type">ValidatedData</span> { <span class="property">valid</span>: <span class="type">any</span>[]; <span class="property">errors</span>: <span class="type">string</span>[]; }
<span class="keyword">type</span> <span class="type">ValidateFnArgs</span> = [<span class="property">data</span>: <span class="type">RawData</span>, <span class="property">strict</span>: <span class="type">boolean</span>];
<span class="keyword">type</span> <span class="type">ValidateFnReturn</span> = <span class="type">ValidatedData</span>;

<span class="comment">// Union types for workflow with mixed request/response types</span>
<span class="keyword">type</span> <span class="type">WorkflowRequestBody</span> = <span class="type">FetchRequest</span> | <span class="type">PersistRequest</span>;
<span class="keyword">type</span> <span class="type">WorkflowResponseData</span> = <span class="type">RawData</span> | <span class="type">EnrichedData</span> | <span class="type">PersistResult</span>;

<span class="keyword">const</span> phases: <span class="type">STABLE_WORKFLOW_PHASE</span>&lt;<span class="type">WorkflowRequestBody</span>, <span class="type">WorkflowResponseData</span>, <span class="type">ValidateFnArgs</span>, <span class="type">ValidateFnReturn</span>&gt;[] = [
  <span class="comment">// Phase 1: Fetch raw data (sequential)</span>
  {
    <span class="property">id</span>: <span class="string">'fetch-data'</span>,
    <span class="property">requests</span>: [{
      <span class="property">id</span>: <span class="string">'get-raw-data'</span>,
      <span class="property">requestOptions</span>: {
        <span class="property">reqData</span>: {
          <span class="property">hostname</span>: <span class="string">'data-lake.internal'</span>,
          <span class="property">path</span>: <span class="string">'/exports/latest'</span>
        },
        <span class="property">resReq</span>: <span class="keyword">true</span>,
        <span class="property">attempts</span>: <span class="number">3</span>,
        <span class="property">cache</span>: { <span class="property">enabled</span>: <span class="keyword">true</span>, <span class="property">ttl</span>: <span class="number">300000</span> }
      }
    }],
    <span class="comment">// Store results in shared buffer for later phases</span>
    <span class="property">phaseDecisionHook</span>: <span class="keyword">async ({ phaseResult, sharedBuffer }) =></span> {
      <span class="keyword">if</span> (phaseResult.success && sharedBuffer) {
        sharedBuffer.rawData = phaseResult.responses[<span class="number">0</span>].data;
        sharedBuffer.recordCount = (phaseResult.responses[<span class="number">0</span>].data <span class="keyword">as</span> <span class="type">RawData</span>).records.length;
        <span class="keyword">return</span> { <span class="property">action</span>: PHASE_DECISION_ACTIONS.<span class="property">CONTINUE</span> };
      }
      <span class="keyword">return</span> { <span class="property">action</span>: PHASE_DECISION_ACTIONS.<span class="property">TERMINATE</span> };
    }
  },
  
  <span class="comment">// Phase 2: Validate (marks start of concurrent group)</span>
  {
    <span class="property">id</span>: <span class="string">'validate'</span>,
    <span class="property">markConcurrentPhase</span>: <span class="keyword">true</span>, <span class="comment">// Runs concurrently with phase 3</span>
    <span class="property">items</span>: [{
      <span class="property">type</span>: RequestOrFunction.<span class="property">FUNCTION</span>,
      <span class="property">function</span>: {
        <span class="property">id</span>: <span class="string">'validate-records'</span>,
        <span class="property">functionOptions</span>: {
          <span class="property">fn</span>: <span class="keyword">async (data: <span class="type">RawData</span>, strict: <span class="type">boolean</span>): <span class="type">Promise</span>&lt;<span class="type">ValidatedData</span>&gt; =></span> {
            <span class="keyword">const</span> valid = data.records.filter(<span class="keyword">r =></span> validateRecord(r, strict));
            <span class="keyword">return</span> { <span class="property">valid</span>, <span class="property">errors</span>: [] };
          },
          <span class="property">args</span>: [{ <span class="property">records</span>: [], <span class="property">timestamp</span>: <span class="string">''</span> }, <span class="keyword">true</span>],
          <span class="property">returnResult</span>: <span class="keyword">true</span>
        }
      }
    }],
    <span class="property">maxReplayCount</span>: <span class="number">2</span>,
    <span class="property">allowReplay</span>: <span class="keyword">true</span>,
    <span class="property">phaseDecisionHook</span>: <span class="keyword">async ({ phaseResult, sharedBuffer, executionHistory }) =></span> {
      <span class="keyword">const</span> validData = phaseResult.responses[<span class="number">0</span>].data <span class="keyword">as</span> <span class="type">ValidatedData</span>;
      <span class="keyword">const</span> replayCount = executionHistory.filter(<span class="keyword">e =></span> e.phaseId === <span class="string">'validate'</span>).length;
      
      <span class="comment">// If too many invalid records, retry with relaxed validation</span>
      <span class="keyword">if</span> (sharedBuffer && validData.valid.length < sharedBuffer.recordCount * <span class="number">0.8</span>) {
        <span class="keyword">if</span> (replayCount < <span class="number">2</span>) {
          sharedBuffer.strictValidation = <span class="keyword">false</span>;
          <span class="keyword">return</span> { <span class="property">action</span>: PHASE_DECISION_ACTIONS.<span class="property">REPLAY</span> };
        }
      }
      
      <span class="keyword">if</span> (sharedBuffer) sharedBuffer.validatedData = validData.valid;
      <span class="keyword">return</span> { <span class="property">action</span>: PHASE_DECISION_ACTIONS.<span class="property">CONTINUE</span> };
    }
  },
  
  <span class="comment">// Phase 3: Enrich (concurrent with validation)</span>
  {
    <span class="property">id</span>: <span class="string">'enrich'</span>,
    <span class="property">markConcurrentPhase</span>: <span class="keyword">true</span>, <span class="comment">// Same concurrent group</span>
    <span class="property">requests</span>: [{
      <span class="property">id</span>: <span class="string">'fetch-enrichment'</span>,
      <span class="property">requestOptions</span>: {
        <span class="property">reqData</span>: {
          <span class="property">hostname</span>: <span class="string">'enrichment-service.internal'</span>,
          <span class="property">path</span>: <span class="string">'/metadata'</span>
        },
        <span class="property">resReq</span>: <span class="keyword">true</span>
      }
    }],
    <span class="property">allowSkip</span>: <span class="keyword">true</span>,
    <span class="property">phaseDecisionHook</span>: <span class="keyword">async ({ phaseResult, sharedBuffer }) =></span> {
      <span class="keyword">if</span> (!phaseResult.success) {
        <span class="comment">// Enrichment is optional - continue without it</span>
        <span class="keyword">if</span> (sharedBuffer) sharedBuffer.enrichmentSkipped = <span class="keyword">true</span>;
        <span class="keyword">return</span> { <span class="property">action</span>: PHASE_DECISION_ACTIONS.<span class="property">CONTINUE</span> };
      }
      
      <span class="comment">// Check data freshness</span>
      <span class="keyword">const</span> enrichment = phaseResult.responses[<span class="number">0</span>].data <span class="keyword">as</span> <span class="type">EnrichedData</span>;
      <span class="keyword">const</span> age = Date.now() - <span class="keyword">new</span> Date(enrichment.enrichedAt).getTime();
      <span class="keyword">if</span> (age > <span class="number">3600000</span>) { <span class="comment">// > 1 hour old</span>
        <span class="keyword">if</span> (sharedBuffer) sharedBuffer.enrichmentSkipped = <span class="keyword">true</span>;
        <span class="keyword">return</span> { <span class="property">action</span>: PHASE_DECISION_ACTIONS.<span class="property">CONTINUE</span> };
      }
      
      <span class="keyword">if</span> (sharedBuffer) sharedBuffer.enrichmentData = enrichment;
      <span class="keyword">return</span> { <span class="property">action</span>: PHASE_DECISION_ACTIONS.<span class="property">CONTINUE</span> };
    }
  },
  
  <span class="comment">// Phase 4: Persist (sequential, after concurrent group)</span>
  {
    <span class="property">id</span>: <span class="string">'persist'</span>,
    <span class="property">requests</span>: [{
      <span class="property">id</span>: <span class="string">'save-to-warehouse'</span>,
      <span class="property">requestOptions</span>: {
        <span class="property">reqData</span>: {
          <span class="property">hostname</span>: <span class="string">'data-warehouse.internal'</span>,
          <span class="property">path</span>: <span class="string">'/ingest'</span>,
          <span class="property">method</span>: REQUEST_METHODS.<span class="property">POST</span>
        },
        <span class="property">resReq</span>: <span class="keyword">false</span>,
        <span class="property">attempts</span>: <span class="number">5</span>,
        <span class="property">retryStrategy</span>: RETRY_STRATEGIES.<span class="property">EXPONENTIAL</span>
      }
    }]
  }
];

<span class="comment">// Execute with mixed mode enabled (explicit generics for full type safety)</span>
<span class="keyword">const</span> result = <span class="keyword">await</span> stableWorkflow&lt;<span class="type">WorkflowRequestBody</span>, <span class="type">WorkflowResponseData</span>, <span class="type">ValidateFnArgs</span>, <span class="type">ValidateFnReturn</span>&gt;(phases, {
  <span class="property">workflowId</span>: <span class="string">'data-pipeline-001'</span>,
  
  <span class="comment">// Enable mixed execution (sequential + concurrent groups)</span>
  <span class="property">enableMixedExecution</span>: <span class="keyword">true</span>,
  <span class="property">enableNonLinearExecution</span>: <span class="keyword">true</span>, <span class="comment">// Enable REPLAY/SKIP/JUMP</span>
  
  <span class="comment">// Global configuration</span>
  <span class="property">commonAttempts</span>: <span class="number">2</span>,
  <span class="property">commonWait</span>: <span class="number">1000</span>,
  <span class="property">maxWorkflowIterations</span>: <span class="number">100</span>, <span class="comment">// Safety limit</span>
  
  <span class="comment">// Shared state across all phases</span>
  <span class="property">sharedBuffer</span>: {
    <span class="property">pipelineStart</span>: Date.now(),
    <span class="property">strictValidation</span>: <span class="keyword">true</span>
  },
  
  <span class="comment">// Workflow-level circuit breaker</span>
  <span class="property">circuitBreaker</span>: { <span class="property">failureThresholdPercentage</span>: <span class="number">50</span>, <span class="property">minimumRequests</span>: <span class="number">3</span>, <span class="property">recoveryTimeoutMs</span>: <span class="number">60000</span> },
  
  <span class="comment">// Observability hooks</span>
  <span class="property">handlePhaseCompletion</span>: <span class="keyword">({ phaseResult, workflowId }) =></span> {
    logger.info(<span class="string">`Phase ${phaseResult.phaseId} completed`</span>, {
      <span class="property">workflowId</span>,
      <span class="property">success</span>: phaseResult.success,
      <span class="property">duration</span>: phaseResult.metrics?.executionTime
    });
  },
  <span class="property">handlePhaseDecision</span>: <span class="keyword">({ decision, phaseResult }) =></span> {
    logger.debug(<span class="string">`Decision for ${phaseResult.phaseId}: ${decision.action}`</span>);
  },
  
  <span class="comment">// State persistence for recovery</span>
  <span class="property">statePersistence</span>: {
    <span class="property">persistenceFunction</span>: <span class="keyword">async ({ executionContext, buffer }) =></span> {
      <span class="keyword">const</span> key = <span class="string">`workflow:${executionContext.workflowId}`</span>;
      <span class="keyword">await</span> redis.set(key, buffer);
      <span class="keyword">return</span> (<span class="keyword">await</span> redis.get(key)) || buffer;
    }
  },
  
  <span class="comment">// Metrics guardrails</span>
  <span class="property">metricsGuardrails</span>: {
    <span class="property">workflow</span>: { <span class="property">totalPhases</span>: { <span class="property">max</span>: <span class="number">10</span> }, <span class="property">executionTime</span>: { <span class="property">max</span>: <span class="number">300000</span> } }
  }
});

<span class="comment">// Access workflow results</span>
console.log(<span class="string">`Workflow success: ${result.success}`</span>);
console.log(<span class="string">`Phases executed: ${result.totalPhases}`</span>);
console.log(<span class="string">`Replays: ${result.metrics?.totalPhaseReplays || 0}`</span>);
console.log(<span class="string">`Phase results:`</span>, result.phases.map(<span class="keyword">(p) =></span> p.phaseId));

})();</code></pre>
          </div>
        </div>

        <!-- stableWorkflowGraph Tab -->
        <div class="tab-content" id="tab-stableWorkflowGraph">
          <div class="tab-info">
            <h3><code>stableWorkflowGraph</code></h3>
            <p>DAG-based workflow orchestration with explicit node dependencies, conditional routing, parallel groups, and merge points. Offers higher parallelism than array-based workflows and enables complex topologies like diamond patterns, fan-out/fan-in, and conditional branching based on runtime results.</p>
          </div>
          <div class="problem-statement">
            <h4>Problem Statement</h4>
            <p>Your ML pipeline requires: (1) data preprocessing, then parallel (2) feature extraction and (3) model inference, which merge before (4) post-processing. If inference confidence is low, route to (5) human review instead. You need automatic DAG validation, conditional edge traversal, and the ability to execute independent nodes in true parallel.</p>
          </div>
          <div class="code-box">
            <div class="code-box-header">
              <div class="code-box-dots">
                <span></span><span></span><span></span>
              </div>
              <span class="code-box-lang">TypeScript</span>
              <button class="copy-btn" onclick="copyCode(this)">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="9" y="9" width="13" height="13" rx="2"/><path d="M5 15H4a2 2 0 01-2-2V4a2 2 0 012-2h9a2 2 0 012 2v1"/></svg>
                Copy
              </button>
            </div>
            <pre><code><span class="keyword">import</span> { 
  stableWorkflowGraph, 
  WorkflowGraphBuilder,
  WorkflowEdgeConditionTypes,
  RequestOrFunction,
  REQUEST_METHODS,
  <span class="keyword">type</span> <span class="type">ConditionalEvaluationContext</span>
} <span class="keyword">from</span> <span class="string">'@emmvish/stable-request'</span>;

(<span class="keyword">async</span> () => {

<span class="comment">// Mock dependencies for demonstration</span>
<span class="keyword">const</span> inputBuffer = Buffer.from(<span class="string">'mock-input-data'</span>);
<span class="keyword">const</span> logger = { <span class="property">info</span>: console.info };
<span class="keyword">const</span> preprocessPipeline = {
  <span class="property">execute</span>: <span class="keyword">async</span> (data: <span class="type">Buffer</span>) => ({ <span class="property">normalized</span>: <span class="keyword">true</span>, <span class="property">data</span>: data.toString() })
};
<span class="keyword">const</span> featureExtractor = {
  <span class="property">extract</span>: <span class="keyword">async</span> (input: <span class="type">any</span>) => ({ <span class="property">features</span>: [<span class="number">0.1</span>, <span class="number">0.5</span>, <span class="number">0.3</span>] })
};

<span class="comment">// Define request body types</span>
<span class="keyword">interface</span> <span class="type">MLRequest</span> { <span class="property">features</span>?: <span class="type">number</span>[]; <span class="property">data</span>?: <span class="type">any</span>; }
<span class="keyword">interface</span> <span class="type">ReviewRequest</span> { <span class="property">itemId</span>: <span class="type">string</span>; <span class="property">data</span>: <span class="type">any</span>; }
<span class="keyword">interface</span> <span class="type">StoreRequest</span> { <span class="property">results</span>: <span class="type">any</span>; <span class="property">metadata</span>: <span class="type">Record</span>&lt;<span class="type">string</span>, <span class="type">any</span>&gt;; }

<span class="comment">// Define response types</span>
<span class="keyword">interface</span> <span class="type">PreprocessResult</span> { <span class="property">normalized</span>: <span class="type">boolean</span>; <span class="property">data</span>: <span class="type">string</span>; }
<span class="keyword">interface</span> <span class="type">InferenceResult</span> { <span class="property">confidence</span>: <span class="type">number</span>; <span class="property">predictions</span>: <span class="type">any</span>[]; }
<span class="keyword">interface</span> <span class="type">FeatureResult</span> { <span class="property">features</span>: <span class="type">number</span>[]; }
<span class="keyword">interface</span> <span class="type">ReviewResult</span> { <span class="property">queued</span>: <span class="type">boolean</span>; <span class="property">reviewId</span>: <span class="type">string</span>; }
<span class="keyword">interface</span> <span class="type">StoreResult</span> { <span class="property">stored</span>: <span class="type">boolean</span>; }
<span class="keyword">interface</span> <span class="type">FormatResult</span> { <span class="property">features</span>: <span class="type">any</span>; <span class="property">predictions</span>: <span class="type">any</span>; <span class="property">timestamp</span>: <span class="type">string</span>; }

<span class="comment">// Union types for graph workflow</span>
<span class="keyword">type</span> <span class="type">GraphRequestBody</span> = <span class="type">MLRequest</span> | <span class="type">ReviewRequest</span> | <span class="type">StoreRequest</span>;
<span class="keyword">type</span> <span class="type">GraphResponseData</span> = <span class="type">PreprocessResult</span> | <span class="type">InferenceResult</span> | <span class="type">FeatureResult</span> | <span class="type">ReviewResult</span> | <span class="type">StoreResult</span> | <span class="type">FormatResult</span>;

<span class="comment">// Function types (use any[] for heterogeneous function signatures)</span>
<span class="keyword">type</span> <span class="type">GraphFunctionArgs</span> = <span class="type">any</span>[];
<span class="keyword">type</span> <span class="type">GraphFunctionReturn</span> = <span class="type">PreprocessResult</span> | <span class="type">FeatureResult</span> | <span class="type">FormatResult</span>;

<span class="comment">// Build the workflow graph with fluent API (using all 4 generics)</span>
<span class="keyword">const</span> graph = <span class="keyword">new</span> <span class="function">WorkflowGraphBuilder</span>&lt;<span class="type">GraphRequestBody</span>, <span class="type">GraphResponseData</span>, <span class="type">GraphFunctionArgs</span>, <span class="type">GraphFunctionReturn</span>&gt;()
  
  <span class="comment">// Entry point: Data preprocessing</span>
  .<span class="function">addPhase</span>(<span class="string">'preprocess'</span>, {
    <span class="property">items</span>: [{
      <span class="property">type</span>: RequestOrFunction.<span class="property">FUNCTION</span>,
      <span class="property">function</span>: {
        <span class="property">id</span>: <span class="string">'normalize-data'</span>,
        <span class="property">functionOptions</span>: {
          <span class="property">fn</span>: <span class="keyword">async (rawData: <span class="type">Buffer</span>) =></span> {
            <span class="comment">// Normalize, resize, convert formats</span>
            <span class="keyword">return</span> preprocessPipeline.execute(rawData);
          },
          <span class="property">args</span>: [inputBuffer],
          <span class="property">returnResult</span>: <span class="keyword">true</span>,
          <span class="property">executionTimeout</span>: <span class="number">30000</span>
        }
      }
    }]
  })
  
  <span class="comment">// Parallel group: Feature extraction + Model inference</span>
  .<span class="function">addPhase</span>(<span class="string">'extract-features'</span>, {
    <span class="property">items</span>: [{
      <span class="property">type</span>: RequestOrFunction.<span class="property">FUNCTION</span>,
      <span class="property">function</span>: {
        <span class="property">id</span>: <span class="string">'feature-extractor'</span>,
        <span class="property">functionOptions</span>: {
          <span class="property">fn</span>: featureExtractor.extract,
          <span class="property">args</span>: [<span class="keyword">null</span>], <span class="comment">// Will be populated from sharedBuffer</span>
          <span class="property">returnResult</span>: <span class="keyword">true</span>,
          <span class="property">cache</span>: { <span class="property">enabled</span>: <span class="keyword">true</span>, <span class="property">ttl</span>: <span class="number">600000</span> }
        }
      }
    }]
  })
  
  .<span class="function">addPhase</span>(<span class="string">'run-inference'</span>, {
    <span class="property">requests</span>: [{
      <span class="property">id</span>: <span class="string">'ml-inference'</span>,
      <span class="property">requestOptions</span>: {
        <span class="property">reqData</span>: {
          <span class="property">hostname</span>: <span class="string">'ml-service.internal'</span>,
          <span class="property">path</span>: <span class="string">'/predict'</span>,
          <span class="property">method</span>: REQUEST_METHODS.<span class="property">POST</span>
        },
        <span class="property">resReq</span>: <span class="keyword">true</span>,
        <span class="property">attempts</span>: <span class="number">3</span>,
        <span class="property">responseAnalyzer</span>: <span class="keyword">({ data }) =></span> (data <span class="keyword">as</span> <span class="type">InferenceResult</span>)?.confidence !== <span class="keyword">undefined</span>
      }
    }]
  })
  
  <span class="comment">// Create parallel group node</span>
  .<span class="function">addParallelGroup</span>(<span class="string">'parallel-processing'</span>, [<span class="string">'extract-features'</span>, <span class="string">'run-inference'</span>])
  
  <span class="comment">// Merge point: Wait for parallel group to complete</span>
  .<span class="function">addMergePoint</span>(<span class="string">'sync-results'</span>, [<span class="string">'parallel-processing'</span>])
  
  <span class="comment">// Conditional routing based on inference confidence</span>
  .<span class="function">addConditional</span>(<span class="string">'confidence-check'</span>, <span class="keyword">({ results, sharedBuffer }: <span class="type">ConditionalEvaluationContext</span>&lt;<span class="type">GraphRequestBody</span>, <span class="type">GraphResponseData</span>, <span class="type">GraphFunctionArgs</span>, <span class="type">GraphFunctionReturn</span>&gt;) =></span> {
    <span class="keyword">const</span> inferenceResult = results.get(<span class="string">'run-inference'</span>);
    <span class="keyword">const</span> confidence = (inferenceResult?.responses?.[<span class="number">0</span>]?.data <span class="keyword">as</span> <span class="type">InferenceResult</span>)?.confidence || <span class="number">0</span>;
    
    <span class="comment">// Route to human review if confidence is low</span>
    <span class="keyword">if</span> (confidence < <span class="number">0.85</span>) {
      <span class="keyword">if</span> (sharedBuffer) sharedBuffer.needsReview = <span class="keyword">true</span>;
      <span class="keyword">return</span> <span class="string">'human-review'</span>;
    }
    <span class="keyword">return</span> <span class="string">'postprocess'</span>;
  })
  
  <span class="comment">// Human review path</span>
  .<span class="function">addPhase</span>(<span class="string">'human-review'</span>, {
    <span class="property">requests</span>: [{
      <span class="property">id</span>: <span class="string">'queue-review'</span>,
      <span class="property">requestOptions</span>: {
        <span class="property">reqData</span>: {
          <span class="property">hostname</span>: <span class="string">'review-queue.internal'</span>,
          <span class="property">path</span>: <span class="string">'/submit'</span>,
          <span class="property">method</span>: REQUEST_METHODS.<span class="property">POST</span>
        },
        <span class="property">resReq</span>: <span class="keyword">true</span>
      }
    }]
  })
  
  <span class="comment">// Post-processing path</span>
  .<span class="function">addPhase</span>(<span class="string">'postprocess'</span>, {
    <span class="property">items</span>: [{
      <span class="property">type</span>: RequestOrFunction.<span class="property">FUNCTION</span>,
      <span class="property">function</span>: {
        <span class="property">id</span>: <span class="string">'format-output'</span>,
        <span class="property">functionOptions</span>: {
          <span class="property">fn</span>: <span class="keyword">async (features: <span class="type">any</span>, predictions: <span class="type">any</span>) =></span> {
            <span class="keyword">return</span> {
              <span class="property">features</span>,
              <span class="property">predictions</span>,
              <span class="property">timestamp</span>: <span class="keyword">new</span> Date().toISOString()
            };
          },
          <span class="property">args</span>: [{}, {}],
          <span class="property">returnResult</span>: <span class="keyword">true</span>
        }
      }
    }]
  })
  
  <span class="comment">// Final merge: Both paths converge</span>
  .<span class="function">addMergePoint</span>(<span class="string">'final-merge'</span>, [<span class="string">'human-review'</span>, <span class="string">'postprocess'</span>])
  
  <span class="comment">// Final output phase</span>
  .<span class="function">addPhase</span>(<span class="string">'output'</span>, {
    <span class="property">requests</span>: [{
      <span class="property">id</span>: <span class="string">'store-results'</span>,
      <span class="property">requestOptions</span>: {
        <span class="property">reqData</span>: {
          <span class="property">hostname</span>: <span class="string">'results-store.internal'</span>,
          <span class="property">path</span>: <span class="string">'/save'</span>,
          <span class="property">method</span>: REQUEST_METHODS.<span class="property">POST</span>
        },
        <span class="property">resReq</span>: <span class="keyword">false</span>,
        <span class="property">attempts</span>: <span class="number">5</span>
      }
    }]
  })
  
  <span class="comment">// Connect nodes with edge conditions</span>
  .<span class="function">connect</span>(<span class="string">'preprocess'</span>, <span class="string">'parallel-processing'</span>, { 
    <span class="property">condition</span>: { <span class="property">type</span>: WorkflowEdgeConditionTypes.<span class="property">SUCCESS</span> }
  })
  .<span class="function">connect</span>(<span class="string">'parallel-processing'</span>, <span class="string">'sync-results'</span>)
  .<span class="function">connect</span>(<span class="string">'sync-results'</span>, <span class="string">'confidence-check'</span>)
  <span class="comment">// Conditional routing edges (handled by conditional node)</span>
  .<span class="function">connect</span>(<span class="string">'human-review'</span>, <span class="string">'final-merge'</span>)
  .<span class="function">connect</span>(<span class="string">'postprocess'</span>, <span class="string">'final-merge'</span>)
  .<span class="function">connect</span>(<span class="string">'final-merge'</span>, <span class="string">'output'</span>)
  
  <span class="comment">// Set entry and build</span>
  .<span class="function">setEntryPoint</span>(<span class="string">'preprocess'</span>)
  .<span class="function">build</span>();

<span class="comment">// Execute the graph workflow (with all 4 explicit generics)</span>
<span class="keyword">const</span> result = <span class="keyword">await</span> stableWorkflowGraph&lt;<span class="type">GraphRequestBody</span>, <span class="type">GraphResponseData</span>, <span class="type">GraphFunctionArgs</span>, <span class="type">GraphFunctionReturn</span>&gt;(graph, {
  <span class="property">workflowId</span>: <span class="string">'ml-pipeline-001'</span>,
  
  <span class="comment">// Shared state across all nodes</span>
  <span class="property">sharedBuffer</span>: {
    <span class="property">inputId</span>: <span class="string">'sample-12345'</span>,
    <span class="property">modelVersion</span>: <span class="string">'v2.3.1'</span>
  },
  
  <span class="comment">// Global configuration</span>
  <span class="property">commonAttempts</span>: <span class="number">2</span>,
  <span class="property">commonWait</span>: <span class="number">1000</span>,
  <span class="property">maxConcurrentRequests</span>: <span class="number">10</span>,
  
  <span class="comment">// Circuit breaker for entire graph</span>
  <span class="property">circuitBreaker</span>: { <span class="property">failureThresholdPercentage</span>: <span class="number">50</span>, <span class="property">minimumRequests</span>: <span class="number">5</span>, <span class="property">recoveryTimeoutMs</span>: <span class="number">60000</span> },
  
  <span class="comment">// Graph-level timeout</span>
  <span class="property">maxTimeout</span>: <span class="number">120000</span>,
  
  <span class="comment">// Observability</span>
  <span class="property">handlePhaseCompletion</span>: <span class="keyword">({ phaseResult }) =></span> {
    logger.info(<span class="string">`Node ${phaseResult.phaseId} completed`</span>);
  },
  
  <span class="comment">// Execution context for tracing</span>
  <span class="property">executionContext</span>: { <span class="property">workflowId</span>: <span class="string">'ml-pipeline-001'</span> }
});

<span class="comment">// Access results</span>
console.log(<span class="string">`Graph success: ${result.success}`</span>);
console.log(<span class="string">`Nodes executed: ${result.executionHistory?.length}`</span>);
console.log(<span class="string">`Path taken: ${result.executionHistory?.map((n) => n.phaseId).join(' → ')}`</span>);
<span class="comment">// Note: sharedBuffer is passed in options but not returned in result</span>
<span class="comment">// Check phases for specific results instead</span>
<span class="keyword">const</span> inferencePhase = result.phases.find(<span class="keyword">(p) =></span> p.phaseId === <span class="string">'run-inference'</span>);
<span class="keyword">const</span> needsReview = (inferencePhase?.responses?.[<span class="number">0</span>]?.data <span class="keyword">as</span> <span class="type">InferenceResult</span>)?.confidence < <span class="number">0.85</span>;
console.log(<span class="string">`Human review needed: ${needsReview}`</span>);

})();</code></pre>
          </div>
        </div>
      </div>
    </section>

    <!-- Resilience Stack Section -->
    <section class="section" id="resilience-stack">
      <div class="section-header">
        <h2><span class="gradient-text">Stability-First</span> Resilience Stack</h2>
        <p>Every execution mode inherits a comprehensive suite of production-ready resilience mechanisms — built-in, not bolted-on.</p>
      </div>

      <div class="resilience-grid">
        <div class="resilience-card">
          <div class="resilience-icon">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"/><circle cx="12" cy="12" r="3"/></svg>
          </div>
          <h4>Intelligence Hooks</h4>
          <p>Response analyzers and error analyzers provide decision hooks for intelligent retry logic based on actual response content, not just HTTP status codes.</p>
        </div>

        <div class="resilience-card">
          <div class="resilience-icon">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M22 12h-4l-3 9L9 3l-3 9H2"/></svg>
          </div>
          <h4>Observability Hooks</h4>
          <p>Comprehensive logging via handleErrors and handleSuccessfulAttemptData hooks. Track every attempt with timestamps, execution times, and custom metadata.</p>
        </div>

        <div class="resilience-card">
          <div class="resilience-icon">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="1 4 1 10 7 10"/><path d="M3.51 15a9 9 0 1 0 2.13-9.36L1 10"/></svg>
          </div>
          <h4>Retry Strategies</h4>
          <p>FIXED, LINEAR, and EXPONENTIAL backoff with configurable jitter to prevent thundering herd. Set max attempts, wait times, and caps.</p>
        </div>

        <div class="resilience-card">
          <div class="resilience-icon">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M18.36 6.64a9 9 0 1 1-12.73 0"/><line x1="12" y1="2" x2="12" y2="12"/></svg>
          </div>
          <h4>Circuit Breaking</h4>
          <p>Three-state fail-fast protection (CLOSED → OPEN → HALF_OPEN). Configurable failure thresholds, reset timeouts, and half-open request limits.</p>
        </div>

        <div class="resilience-card">
          <div class="resilience-icon">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="3" y="3" width="18" height="18" rx="2"/><path d="M3 9h18M9 21V9"/></svg>
          </div>
          <h4>Caching</h4>
          <p>HTTP response caching and function memoization with TTL, LRU eviction, and custom key generators. Respects cache-control headers.</p>
        </div>

        <div class="resilience-card">
          <div class="resilience-icon">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M12 2v4M12 18v4M4.93 4.93l2.83 2.83M16.24 16.24l2.83 2.83M2 12h4M18 12h4M4.93 19.07l2.83-2.83M16.24 7.76l2.83-2.83"/></svg>
          </div>
          <h4>Rate Limiting</h4>
          <p>Sliding-window token bucket rate limiter. Configure max requests per window to respect external API quotas and prevent throttling.</p>
        </div>

        <div class="resilience-card">
          <div class="resilience-icon">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="3" y="11" width="18" height="11" rx="2"/><path d="M7 11V7a5 5 0 0110 0v4"/></svg>
          </div>
          <h4>Concurrency Limiting</h4>
          <p>Semaphore-based concurrency control. Limit parallel executions to prevent resource exhaustion and respect downstream capacity.</p>
        </div>

        <div class="resilience-card">
          <div class="resilience-icon">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M3 3v18h18"/><path d="M18 17V9"/><path d="M13 17V5"/><path d="M8 17v-3"/></svg>
          </div>
          <h4>Config Cascading</h4>
          <p>Global → Phase → Branch → Group → Item (Request / Function) configuration hierarchy. Lower levels override higher levels, preventing repetition while maintaining expressiveness.</p>
        </div>

        <div class="resilience-card">
          <div class="resilience-icon">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="2" y="2" width="20" height="8" rx="2"/><rect x="2" y="14" width="20" height="8" rx="2"/><line x1="6" y1="6" x2="6.01" y2="6"/><line x1="6" y1="18" x2="6.01" y2="18"/></svg>
          </div>
          <h4>Shared Buffers & Persistence</h4>
          <p>Mutable shared state accessible across attempts, phases, branches, and items. Pass computed data without global state pollution. Buffers can be persisted using State Persistence Hooks.</p>
        </div>

        <div class="resilience-card">
          <div class="resilience-icon">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M14.7 6.3a1 1 0 000 1.4l1.6 1.6a1 1 0 001.4 0l3.77-3.77a6 6 0 01-7.94 7.94l-6.91 6.91a2.12 2.12 0 01-3-3l6.91-6.91a6 6 0 017.94-7.94l-3.76 3.76z"/></svg>
          </div>
          <h4>Pre-Execution Hooks</h4>
          <p>Dynamic configuration injection before execution. Load tokens, modify arguments, or override config based on runtime conditions.</p>
        </div>

        <div class="resilience-card">
          <div class="resilience-icon">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M14 2H6a2 2 0 00-2 2v16a2 2 0 002 2h12a2 2 0 002-2V8z"/><path d="M14 2v6h6M16 13H8M16 17H8M10 9H8"/></svg>
          </div>
          <h4>Trial Mode</h4>
          <p>Dry-run execution without actual HTTP calls or side effects. Test workflows, validate configurations, and debug decision logic safely.</p>
        </div>

        <div class="resilience-card">
          <div class="resilience-icon">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M12 20V10"/><path d="M18 20V4"/><path d="M6 20v-4"/></svg>
          </div>
          <h4>Metrics & Guardrails</h4>
          <p>Comprehensive metrics extraction with validation guardrails. Set min / max thresholds for execution times, success rates, and infrastructure stats.</p>
        </div>
      </div>
    </section>

    <!-- Workflow Capabilities Section -->
    <section class="section workflow-section" id="workflows">
      <div class="section-header">
        <h2><span class="gradient-text">Advanced Workflow</span> Capabilities</h2>
        <p>From simple batch processing to complex DAG orchestration — choose the execution model that fits your topology.</p>
      </div>

      <div class="workflow-intro">
        <p>The framework provides two workflow engines: <strong>stableWorkflow</strong> for array-based phase execution with rich control flow, and <strong>stableWorkflowGraph</strong> for DAG-based execution with explicit dependencies. Both support mixed items (requests + functions) and share the same resilience stack.</p>
      </div>

      <div class="workflow-types">
        <div class="workflow-type-card">
          <h4>
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><line x1="5" y1="12" x2="19" y2="12"/><polyline points="12 5 19 12 12 19"/></svg>
            Sequential Workflows
          </h4>
          <p>Phases execute one after another in array order. Next phase starts only after previous completes.</p>
          <ul>
            <li>Predictable execution order</li>
            <li>Ideal for dependent phases</li>
            <li>Data pipelines (fetch → transform → save)</li>
          </ul>
        </div>

        <div class="workflow-type-card">
          <h4>
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><line x1="8" y1="6" x2="21" y2="6"/><line x1="8" y1="12" x2="21" y2="12"/><line x1="8" y1="18" x2="21" y2="18"/><line x1="3" y1="6" x2="3.01" y2="6"/><line x1="3" y1="12" x2="3.01" y2="12"/><line x1="3" y1="18" x2="3.01" y2="18"/></svg>
            Parallel Phases
          </h4>
          <p>All phases start simultaneously via Promise.all(). Faster execution for independent operations.</p>
          <ul>
            <li>Maximum concurrency</li>
            <li>No guaranteed order</li>
            <li>Bulk operations without dependencies</li>
          </ul>
        </div>

        <div class="workflow-type-card">
          <h4>
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="5.5" cy="17.5" r="2.5"/><circle cx="17.5" cy="15.5" r="2.5"/><path d="M8 17.5h4.5a2 2 0 002-2V9"/><path d="M12 6l3 3-3 3"/></svg>
            Mixed (Hybrid) Execution
          </h4>
          <p>Sequential flow with concurrent groups. Mark phases with <code>markConcurrentPhase</code> to form parallel groups.</p>
          <ul>
            <li>Best of both worlds</li>
            <li>Partial parallelization</li>
            <li>Optimize specific sections</li>
          </ul>
        </div>

        <div class="workflow-type-card">
          <h4>
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="16 3 21 3 21 8"/><line x1="4" y1="20" x2="21" y2="3"/><polyline points="21 16 21 21 16 21"/><line x1="15" y1="15" x2="21" y2="21"/><line x1="4" y1="4" x2="9" y2="9"/></svg>
            Non-Linear Control Flow
          </h4>
          <p>Dynamic control via phase decision hooks: CONTINUE, SKIP, REPLAY, JUMP, TERMINATE.</p>
          <ul>
            <li>Conditional execution</li>
            <li>Phase replay with limits</li>
            <li>Early termination</li>
            <li>State machine patterns</li>
          </ul>
        </div>

        <div class="workflow-type-card">
          <h4>
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="6" cy="6" r="3"/><circle cx="6" cy="18" r="3"/><circle cx="18" cy="18" r="3"/><line x1="6" y1="9" x2="6" y2="15"/><path d="M9 18h6"/></svg>
            Branched Workflows
          </h4>
          <p>Multiple independent execution paths with their own phase sequences. Supports branch racing for first-wins semantics.</p>
          <ul>
            <li>Parallel branches</li>
            <li>A/B testing patterns</li>
            <li>Branch-level decisions</li>
            <li>Racing with cancellation</li>
          </ul>
        </div>

        <div class="workflow-type-card">
          <h4>
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="18" cy="5" r="3"/><circle cx="6" cy="12" r="3"/><circle cx="18" cy="19" r="3"/><path d="M8.59 13.51l6.83 3.98M15.41 6.51l-6.82 3.98"/></svg>
            DAG Workflows
          </h4>
          <p>Graph-based execution with explicit node dependencies, conditional routing, and merge points.</p>
          <ul>
            <li>Diamond patterns</li>
            <li>Fan-out / fan-in</li>
            <li>Conditional edge traversal</li>
            <li>Higher parallelism</li>
          </ul>
        </div>
      </div>

      <div class="comparison-box">
        <h3>Array-Based vs Graph-Based Workflows</h3>
        <table class="comparison-table">
          <thead>
            <tr>
              <th>Feature</th>
              <th>stableWorkflow (Array)</th>
              <th>stableWorkflowGraph (DAG)</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td>Topology Definition</td>
              <td>Phase array with flags</td>
              <td>Explicit nodes and edges</td>
            </tr>
            <tr>
              <td>Parallelism Model</td>
              <td>markConcurrentPhase groups</td>
              <td>Automatic from dependencies</td>
            </tr>
            <tr>
              <td>Conditional Routing</td>
              <td>JUMP / SKIP decisions</td>
              <td>Conditional nodes & edge conditions</td>
            </tr>
            <tr>
              <td>Merge / Sync Points</td>
              <td>End of concurrent group</td>
              <td>Explicit MERGE_POINT nodes</td>
            </tr>
            <tr>
              <td>Phase Replay</td>
              <td><span class="check-icon">✓</span> Built-in</td>
              <td><span class="x-icon">—</span> Via custom logic</td>
            </tr>
            <tr>
              <td>Branching</td>
              <td><span class="check-icon">✓</span> STABLE_WORKFLOW_BRANCH</td>
              <td><span class="check-icon">✓</span> BRANCH nodes</td>
            </tr>
            <tr>
              <td>Branch Racing</td>
              <td><span class="check-icon">✓</span> enableBranchRacing</td>
              <td><span class="check-icon">✓</span> Parallel group racing</td>
            </tr>
            <tr>
              <td>Best For</td>
              <td>Linear / branched flows with control</td>
              <td>Complex DAGs with high parallelism</td>
            </tr>
          </tbody>
        </table>
      </div>
    </section>

    <!-- Footer -->
    <footer class="footer">
      <div class="footer-content">
        <div class="footer-grid">
          <div class="footer-section">
            <h5>Framework</h5>
            <a href="#core-apis">Core APIs</a>
            <a href="#resilience-stack">Resilience Stack</a>
            <a href="#workflows">Workflow Patterns</a>
            <a href="https://github.com/Emmvish/stable-request/tree/main/docs/api-references" target="_blank">API References</a>
          </div>
          <div class="footer-section">
            <h5>Resources</h5>
            <a href="https://www.npmjs.com/package/@emmvish/stable-request" target="_blank">NPM Package</a>
            <a href="https://github.com/emmvish/stable-request" target="_blank">GitHub Repository</a>
            <a href="https://github.com/emmvish/stable-request/issues" target="_blank">Issues</a>
            <a href="https://github.com/emmvish/stable-request/blob/main/LICENSE" target="_blank">License (MIT)</a>
          </div>
          <div class="footer-section">
            <h5>Author</h5>
            <a href="https://emmvish.github.io" target="_blank">Manish Varma</a>
            <a href="https://github.com/emmvish" target="_blank">GitHub Profile</a>
          </div>
        </div>
        <div class="footer-bottom">
          <p>© 2026 <a href="https://www.npmjs.com/package/@emmvish/stable-request" target="_blank">@emmvish/stable-request</a>. Built with a resilient stability-first mindset.</p>
        </div>
      </div>
    </footer>
  </main>

  <script>
    // Sidebar toggle
    const sidebarToggle = document.getElementById('sidebarToggle');
    const sidebar = document.getElementById('sidebar');
    const mainContent = document.getElementById('mainContent');

    sidebarToggle.addEventListener('click', () => {
      sidebar.classList.toggle('collapsed');
      sidebar.classList.toggle('open');
      mainContent.classList.toggle('expanded');
    });

    // Check viewport on load
    function checkViewport() {
      if (window.innerWidth <= 1024) {
        sidebar.classList.add('collapsed');
        mainContent.classList.add('expanded');
      } else {
        sidebar.classList.remove('collapsed');
        mainContent.classList.remove('expanded');
      }
    }
    checkViewport();
    window.addEventListener('resize', checkViewport);

    // Tab functionality
    const tabBtns = document.querySelectorAll('.tab-btn');
    const tabContents = document.querySelectorAll('.tab-content');
    const sidebarTabLinks = document.querySelectorAll('.sidebar-nav a[data-tab]');

    function activateTab(tabId) {
      tabBtns.forEach(btn => {
        btn.classList.toggle('active', btn.dataset.tab === tabId);
      });
      tabContents.forEach(content => {
        content.classList.toggle('active', content.id === 'tab-' + tabId);
      });
    }

    tabBtns.forEach(btn => {
      btn.addEventListener('click', () => activateTab(btn.dataset.tab));
    });

    sidebarTabLinks.forEach(link => {
      link.addEventListener('click', (e) => {
        const tabId = link.dataset.tab;
        if (tabId) {
          activateTab(tabId);
        }
      });
    });

    // Copy code functionality
    function copyCode(btn) {
      const codeBox = btn.closest('.code-box');
      const code = codeBox.querySelector('code').innerText;
      
      navigator.clipboard.writeText(code).then(() => {
        btn.classList.add('copied');
        btn.innerHTML = `
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="20 6 9 17 4 12"/></svg>
          Copied!
        `;
        
        setTimeout(() => {
          btn.classList.remove('copied');
          btn.innerHTML = `
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="9" y="9" width="13" height="13" rx="2"/><path d="M5 15H4a2 2 0 01-2-2V4a2 2 0 012-2h9a2 2 0 012 2v1"/></svg>
            Copy
          `;
        }, 2000);
      });
    }

    // Active sidebar link based on scroll
    const sections = document.querySelectorAll('section[id]');
    const sidebarLinks = document.querySelectorAll('.sidebar-nav a');

    function updateActiveLink() {
      const scrollY = window.scrollY;
      
      sections.forEach(section => {
        const sectionTop = section.offsetTop - 100;
        const sectionHeight = section.offsetHeight;
        const sectionId = section.getAttribute('id');
        
        if (scrollY >= sectionTop && scrollY < sectionTop + sectionHeight) {
          sidebarLinks.forEach(link => {
            link.classList.remove('active');
            if (link.getAttribute('href') === '#' + sectionId) {
              link.classList.add('active');
            }
          });
        }
      });
    }

    window.addEventListener('scroll', updateActiveLink);
    updateActiveLink();

    // Smooth scroll for sidebar links
    sidebarLinks.forEach(link => {
      link.addEventListener('click', (e) => {
        const href = link.getAttribute('href');
        if (href.startsWith('#')) {
          e.preventDefault();
          const target = document.querySelector(href);
          if (target) {
            target.scrollIntoView({ behavior: 'smooth' });
          }
          
          // Close sidebar on mobile after clicking
          if (window.innerWidth <= 1024) {
            sidebar.classList.add('collapsed');
            sidebar.classList.remove('open');
          }
        }
      });
    });
  </script>
</body>
</html>
